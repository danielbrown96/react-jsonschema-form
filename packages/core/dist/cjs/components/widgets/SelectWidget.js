"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _react = _interopRequireDefault(require("react"));

var _propTypes = _interopRequireDefault(require("prop-types"));

var _utils = require("../../utils");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

var nums = new Set(["number", "integer"]);
/**
 * This is a silly limitation in the DOM where option change event values are
 * always retrieved as strings.
 */

function processValue(schema, value) {
  // "enum" is a reserved word, so only "type" and "items" can be destructured
  var type = schema.type,
      items = schema.items;

  if (value === "") {
    return undefined;
  } else if (type === "array" && items && nums.has(items.type)) {
    return value.map(_utils.asNumber);
  } else if (type === "boolean") {
    return value === "true";
  } else if (type === "number") {
    return (0, _utils.asNumber)(value);
  } // If type is undefined, but an enum is present, try and infer the type from
  // the enum values


  if (schema["enum"]) {
    if (schema["enum"].every(function (x) {
      return (0, _utils.guessType)(x) === "number";
    })) {
      return (0, _utils.asNumber)(value);
    } else if (schema["enum"].every(function (x) {
      return (0, _utils.guessType)(x) === "boolean";
    })) {
      return value === "true";
    }
  }

  return value;
}

function getValue(event, multiple) {
  if (multiple) {
    return [].slice.call(event.target.options).filter(function (o) {
      return o.selected;
    }).map(function (o) {
      return o.value;
    });
  } else {
    return event.target.value;
  }
}

function SelectWidget(props) {
  var schema = props.schema,
      id = props.id,
      options = props.options,
      value = props.value,
      required = props.required,
      disabled = props.disabled,
      readonly = props.readonly,
      multiple = props.multiple,
      autofocus = props.autofocus,
      _onChange = props.onChange,
      onBlur = props.onBlur,
      onFocus = props.onFocus,
      placeholder = props.placeholder;
  var enumOptions = options.enumOptions,
      enumDisabled = options.enumDisabled;
  var emptyValue = multiple ? [] : "";
  return _react["default"].createElement("select", {
    id: id,
    multiple: multiple,
    className: "form-control",
    value: typeof value === "undefined" ? emptyValue : value,
    required: required,
    disabled: disabled || readonly,
    autoFocus: autofocus,
    onBlur: onBlur && function (event) {
      var newValue = getValue(event, multiple);
      onBlur(id, processValue(schema, newValue));
    },
    onFocus: onFocus && function (event) {
      var newValue = getValue(event, multiple);
      onFocus(id, processValue(schema, newValue));
    },
    onChange: function onChange(event) {
      var newValue = getValue(event, multiple);

      _onChange(processValue(schema, newValue));
    }
  }, !multiple && schema["default"] === undefined && _react["default"].createElement("option", {
    value: ""
  }, placeholder), enumOptions.map(function (_ref, i) {
    var value = _ref.value,
        label = _ref.label;
    var disabled = enumDisabled && enumDisabled.indexOf(value) != -1;
    return _react["default"].createElement("option", {
      key: i,
      value: value,
      disabled: disabled
    }, label);
  }));
}

SelectWidget.defaultProps = {
  autofocus: false
};

if (process.env.NODE_ENV !== "production") {
  SelectWidget.propTypes = {
    schema: _propTypes["default"].object.isRequired,
    id: _propTypes["default"].string.isRequired,
    options: _propTypes["default"].shape({
      enumOptions: _propTypes["default"].array
    }).isRequired,
    value: _propTypes["default"].any,
    required: _propTypes["default"].bool,
    disabled: _propTypes["default"].bool,
    readonly: _propTypes["default"].bool,
    multiple: _propTypes["default"].bool,
    autofocus: _propTypes["default"].bool,
    onChange: _propTypes["default"].func,
    onBlur: _propTypes["default"].func,
    onFocus: _propTypes["default"].func
  };
}

var _default = SelectWidget;
exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL3dpZGdldHMvU2VsZWN0V2lkZ2V0LmpzIl0sIm5hbWVzIjpbIm51bXMiLCJTZXQiLCJwcm9jZXNzVmFsdWUiLCJzY2hlbWEiLCJ2YWx1ZSIsInR5cGUiLCJpdGVtcyIsInVuZGVmaW5lZCIsImhhcyIsIm1hcCIsImFzTnVtYmVyIiwiZXZlcnkiLCJ4IiwiZ2V0VmFsdWUiLCJldmVudCIsIm11bHRpcGxlIiwic2xpY2UiLCJjYWxsIiwidGFyZ2V0Iiwib3B0aW9ucyIsImZpbHRlciIsIm8iLCJzZWxlY3RlZCIsIlNlbGVjdFdpZGdldCIsInByb3BzIiwiaWQiLCJyZXF1aXJlZCIsImRpc2FibGVkIiwicmVhZG9ubHkiLCJhdXRvZm9jdXMiLCJvbkNoYW5nZSIsIm9uQmx1ciIsIm9uRm9jdXMiLCJwbGFjZWhvbGRlciIsImVudW1PcHRpb25zIiwiZW51bURpc2FibGVkIiwiZW1wdHlWYWx1ZSIsIm5ld1ZhbHVlIiwiaSIsImxhYmVsIiwiaW5kZXhPZiIsImRlZmF1bHRQcm9wcyIsInByb2Nlc3MiLCJlbnYiLCJOT0RFX0VOViIsInByb3BUeXBlcyIsIlByb3BUeXBlcyIsIm9iamVjdCIsImlzUmVxdWlyZWQiLCJzdHJpbmciLCJzaGFwZSIsImFycmF5IiwiYW55IiwiYm9vbCIsImZ1bmMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFFQTs7OztBQUVBLElBQU1BLElBQUksR0FBRyxJQUFJQyxHQUFKLENBQVEsQ0FBQyxRQUFELEVBQVcsU0FBWCxDQUFSLENBQWI7QUFFQTs7Ozs7QUFJQSxTQUFTQyxZQUFULENBQXNCQyxNQUF0QixFQUE4QkMsS0FBOUIsRUFBcUM7QUFDbkM7QUFEbUMsTUFFM0JDLElBRjJCLEdBRVhGLE1BRlcsQ0FFM0JFLElBRjJCO0FBQUEsTUFFckJDLEtBRnFCLEdBRVhILE1BRlcsQ0FFckJHLEtBRnFCOztBQUduQyxNQUFJRixLQUFLLEtBQUssRUFBZCxFQUFrQjtBQUNo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QVVRLElBWkc7QUFhdkJ2QixJQUFBQSxNQUFNLEVBQUVlLHNCQUFVUSxJQWJLO0FBY3ZCdEIsSUFBQUEsT0FBTyxFQUFFYyxzQkFBVVE7QUFkSSxHQUF6QjtBQWdCRDs7ZUFFYy9CLFkiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QgZnJvbSBcInJlYWN0XCI7XHJcbmltcG9ydCBQcm9wVHlwZXMgZnJvbSBcInByb3AtdHlwZXNcIjtcclxuXHJcbmltcG9ydCB7IGFzTnVtYmVyLCBndWVzc1R5cGUgfSBmcm9tIFwiLi4vLi4vdXRpbHNcIjtcclxuXHJcbmNvbnN0IG51bXMgPSBuZXcgU2V0KFtcIm51bWJlclwiLCBcImludGVnZXJcIl0pO1xyXG5cclxuLyoqXHJcbiAqIFRoaXMgaXMgYSBzaWxseSBsaW1pdGF0aW9uIGluIHRoZSBET00gd2hlcmUgb3B0aW9uIGNoYW5nZSBldmVudCB2YWx1ZXMgYXJlXHJcbiAqIGFsd2F5cyByZXRyaWV2ZWQgYXMgc3RyaW5ncy5cclxuICovXHJcbmZ1bmN0aW9uIHByb2Nlc3NWYWx1ZShzY2hlbWEsIHZhbHVlKSB7XHJcbiAgLy8gXCJlbnVtXCIgaXMgYSByZXNlcnZlZCB3b3JkLCBzbyBvbmx5IFwidHlwZVwiIGFuZCBcIml0ZW1zXCIgY2FuIGJlIGRlc3RydWN0dXJlZFxyXG4gIGNvbnN0IHsgdHlwZSwgaXRlbXMgfSA9IHNjaGVtYTtcclxuICBpZiAodmFsdWUgPT09IFwiXCIpIHtcclxuICAgIHJldHVybiB1bmRlZmluZWQ7XHJcbiAgfSBlbHNlIGlmICh0eXBlID09PSBcImFycmF5XCIgJiYgaXRlbXMgJiYgbnVtcy5oYXMoaXRlbXMudHlwZSkpIHtcclxuICAgIHJldHVybiB2YWx1ZS5tYXAoYXNOdW1iZXIpO1xyXG4gIH0gZWxzZSBpZiAodHlwZSA9PT0gXCJib29sZWFuXCIpIHtcclxuICAgIHJldHVybiB2YWx1ZSA9PT0gXCJ0cnVlXCI7XHJcbiAgfSBlbHNlIGlmICh0eXBlID09PSBcIm51bWJlclwiKSB7XHJcbiAgICByZXR1cm4gYXNOdW1iZXIodmFsdWUpO1xyXG4gIH1cclxuXHJcbiAgLy8gSWYgdHlwZSBpcyB1bmRlZmluZWQsIGJ1dCBhbiBlbnVtIGlzIHByZXNlbnQsIHRyeSBhbmQgaW5mZXIgdGhlIHR5cGUgZnJvbVxyXG4gIC8vIHRoZSBlbnVtIHZhbHVlc1xyXG4gIGlmIChzY2hlbWEuZW51bSkge1xyXG4gICAgaWYgKHNjaGVtYS5lbnVtLmV2ZXJ5KHggPT4gZ3Vlc3NUeXBlKHgpID09PSBcIm51bWJlclwiKSkge1xyXG4gICAgICByZXR1cm4gYXNOdW1iZXIodmFsdWUpO1xyXG4gICAgfSBlbHNlIGlmIChzY2hlbWEuZW51bS5ldmVyeSh4ID0+IGd1ZXNzVHlwZSh4KSA9PT0gXCJib29sZWFuXCIpKSB7XHJcbiAgICAgIHJldHVybiB2YWx1ZSA9PT0gXCJ0cnVlXCI7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICByZXR1cm4gdmFsdWU7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGdldFZhbHVlKGV2ZW50LCBtdWx0aXBsZSkge1xyXG4gIGlmIChtdWx0aXBsZSkge1xyXG4gICAgcmV0dXJuIFtdLnNsaWNlXHJcbiAgICAgIC5jYWxsKGV2ZW50LnRhcmdldC5vcHRpb25zKVxyXG4gICAgICAuZmlsdGVyKG8gPT4gby5zZWxlY3RlZClcclxuICAgICAgLm1hcChvID0+IG8udmFsdWUpO1xyXG4gIH0gZWxzZSB7XHJcbiAgICByZXR1cm4gZXZlbnQudGFyZ2V0LnZhbHVlO1xyXG4gIH1cclxufVxyXG5cclxuZnVuY3Rpb24gU2VsZWN0V2lkZ2V0KHByb3BzKSB7XHJcbiAgY29uc3Qge1xyXG4gICAgc2NoZW1hLFxyXG4gICAgaWQsXHJcbiAgICBvcHRpb25zLFxyXG4gICAgdmFsdWUsXHJcbiAgICByZXF1aXJlZCxcclxuICAgIGRpc2FibGVkLFxyXG4gICAgcmVhZG9ubHksXHJcbiAgICBtdWx0aXBsZSxcclxuICAgIGF1dG9mb2N1cyxcclxuICAgIG9uQ2hhbmdlLFxyXG4gICAgb25CbHVyLFxyXG4gICAgb25Gb2N1cyxcclxuICAgIHBsYWNlaG9sZGVyLFxyXG4gIH0gPSBwcm9wcztcclxuICBjb25zdCB7IGVudW1PcHRpb25zLCBlbnVtRGlzYWJsZWQgfSA9IG9wdGlvbnM7XHJcbiAgY29uc3QgZW1wdHlWYWx1ZSA9IG11bHRpcGxlID8gW10gOiBcIlwiO1xyXG4gIHJldHVybiAoXHJcbiAgICA8c2VsZWN0XHJcbiAgICAgIGlkPXtpZH1cclxuICAgICAgbXVsdGlwbGU9e211bHRpcGxlfVxyXG4gICAgICBjbGFzc05hbWU9XCJmb3JtLWNvbnRyb2xcIlxyXG4gICAgICB2YWx1ZT17dHlwZW9mIHZhbHVlID09PSBcInVuZGVmaW5lZFwiID8gZW1wdHlWYWx1ZSA6IHZhbHVlfVxyXG4gICAgICByZXF1aXJlZD17cmVxdWlyZWR9XHJcbiAgICAgIGRpc2FibGVkPXtkaXNhYmxlZCB8fCByZWFkb25seX1cclxuICAgICAgYXV0b0ZvY3VzPXthdXRvZm9jdXN9XHJcbiAgICAgIG9uQmx1cj17XHJcbiAgICAgICAgb25CbHVyICYmXHJcbiAgICAgICAgKGV2ZW50ID0+IHtcclxuICAgICAgICAgIGNvbnN0IG5ld1ZhbHVlID0gZ2V0VmFsdWUoZXZlbnQsIG11bHRpcGxlKTtcclxuICAgICAgICAgIG9uQmx1cihpZCwgcHJvY2Vzc1ZhbHVlKHNjaGVtYSwgbmV3VmFsdWUpKTtcclxuICAgICAgICB9KVxyXG4gICAgICB9XHJcbiAgICAgIG9uRm9jdXM9e1xyXG4gICAgICAgIG9uRm9jdXMgJiZcclxuICAgICAgICAoZXZlbnQgPT4ge1xyXG4gICAgICAgICAgY29uc3QgbmV3VmFsdWUgPSBnZXRWYWx1ZShldmVudCwgbXVsdGlwbGUpO1xyXG4gICAgICAgICAgb25Gb2N1cyhpZCwgcHJvY2Vzc1ZhbHVlKHNjaGVtYSwgbmV3VmFsdWUpKTtcclxuICAgICAgICB9KVxyXG4gICAgICB9XHJcbiAgICAgIG9uQ2hhbmdlPXtldmVudCA9PiB7XHJcbiAgICAgICAgY29uc3QgbmV3VmFsdWUgPSBnZXRWYWx1ZShldmVudCwgbXVsdGlwbGUpO1xyXG4gICAgICAgIG9uQ2hhbmdlKHByb2Nlc3NWYWx1ZShzY2hlbWEsIG5ld1ZhbHVlKSk7XHJcbiAgICAgIH19PlxyXG4gICAgICB7IW11bHRpcGxlICYmIHNjaGVtYS5kZWZhdWx0ID09PSB1bmRlZmluZWQgJiYgKFxyXG4gICAgICAgIDxvcHRpb24gdmFsdWU9XCJcIj57cGxhY2Vob2xkZXJ9PC9vcHRpb24+XHJcbiAgICAgICl9XHJcbiAgICAgIHtlbnVtT3B0aW9ucy5tYXAoKHsgdmFsdWUsIGxhYmVsIH0sIGkpID0+IHtcclxuICAgICAgICBjb25zdCBkaXNhYmxlZCA9IGVudW1EaXNhYmxlZCAmJiBlbnVtRGlzYWJsZWQuaW5kZXhPZih2YWx1ZSkgIT0gLTE7XHJcbiAgICAgICAgcmV0dXJuIChcclxuICAgICAgICAgIDxvcHRpb24ga2V5PXtpfSB2YWx1ZT17dmFsdWV9IGRpc2FibGVkPXtkaXNhYmxlZH0+XHJcbiAgICAgICAgICAgIHtsYWJlbH1cclxuICAgICAgICAgIDwvb3B0aW9uPlxyXG4gICAgICAgICk7XHJcbiAgICAgIH0pfVxyXG4gICAgPC9zZWxlY3Q+XHJcbiAgKTtcclxufVxyXG5cclxuU2VsZWN0V2lkZ2V0LmRlZmF1bHRQcm9wcyA9IHtcclxuICBhdXRvZm9jdXM6IGZhbHNlLFxyXG59O1xyXG5cclxuaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSBcInByb2R1Y3Rpb25cIikge1xyXG4gIFNlbGVjdFdpZGdldC5wcm9wVHlwZXMgPSB7XHJcbiAgICBzY2hlbWE6IFByb3BUeXBlcy5vYmplY3QuaXNSZXF1aXJlZCxcclxuICAgIGlkOiBQcm9wVHlwZXMuc3RyaW5nLmlzUmVxdWlyZWQsXHJcbiAgICBvcHRpb25zOiBQcm9wVHlwZXMuc2hhcGUoe1xyXG4gICAgICBlbnVtT3B0aW9uczogUHJvcFR5cGVzLmFycmF5LFxyXG4gICAgfSkuaXNSZXF1aXJlZCxcclxuICAgIHZhbHVlOiBQcm9wVHlwZXMuYW55LFxyXG4gICAgcmVxdWlyZWQ6IFByb3BUeXBlcy5ib29sLFxyXG4gICAgZGlzYWJsZWQ6IFByb3BUeXBlcy5ib29sLFxyXG4gICAgcmVhZG9ubHk6IFByb3BUeXBlcy5ib29sLFxyXG4gICAgbXVsdGlwbGU6IFByb3BUeXBlcy5ib29sLFxyXG4gICAgYXV0b2ZvY3VzOiBQcm9wVHlwZXMuYm9vbCxcclxuICAgIG9uQ2hhbmdlOiBQcm9wVHlwZXMuZnVuYyxcclxuICAgIG9uQmx1cjogUHJvcFR5cGVzLmZ1bmMsXHJcbiAgICBvbkZvY3VzOiBQcm9wVHlwZXMuZnVuYyxcclxuICB9O1xyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCBTZWxlY3RXaWRnZXQ7XHJcbiJdfQ==