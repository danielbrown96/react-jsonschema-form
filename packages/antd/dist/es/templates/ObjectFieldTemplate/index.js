import React from 'react';
import classNames from 'classnames';
import _ from 'lodash';
import { utils } from '@rjsf/core';
import Button from 'antd/lib/button';
import Col from 'antd/lib/col';
import Row from 'antd/lib/row';
import { withConfigConsumer } from 'antd/lib/config-provider/context';
import PlusCircleOutlined from '@ant-design/icons/PlusCircleOutlined';
var canExpand = utils.canExpand;
var DESCRIPTION_COL_STYLE = {
  paddingBottom: '8px'
};

var ObjectFieldTemplate = function ObjectFieldTemplate(_ref) {
  var DescriptionField = _ref.DescriptionField,
      TitleField = _ref.TitleField,
      description = _ref.description,
      disabled = _ref.disabled,
      formContext = _ref.formContext,
      formData = _ref.formData,
      idSchema = _ref.idSchema,
      onAddClick = _ref.onAddClick,
      prefixCls = _ref.prefixCls,
      properties = _ref.properties,
      readonly = _ref.readonly,
      required = _ref.required,
      schema = _ref.schema,
      title = _ref.title,
      uiSchema = _ref.uiSchema;
  var _formContext$colSpan = formContext.colSpan,
      colSpan = _formContext$colSpan === void 0 ? 24 : _formContext$colSpan,
      _formContext$labelAli = formContext.labelAlign,
      labelAlign = _formContext$labelAli === void 0 ? 'right' : _formContext$labelAli,
      _formContext$rowGutte = formContext.rowGutter,
      rowGutter = _formContext$rowGutte === void 0 ? 24 : _formContext$rowGutte;
  var labelClsBasic = "".concat(prefixCls, "-item-label");
  var labelColClassName = classNames(labelClsBasic, labelAlign === 'left' && "".concat(labelClsBasic, "-left") // labelCol.className,
  );

  var findSchema = function findSchema(element) {
    return element.content.props.schema;
  };

  var findSchemaType = function findSchemaType(element) {
    return findSchema(element).type;
  };

  var findUiSchema = function findUiSchema(element) {
    return element.content.props.uiSchema;
  };

  var findUiSchemaField = function findUiSchemaField(element) {
    return findUiSchema(element)['ui:field'];
  };

  var findUiSchemaWidget = function findUiSchemaWidget(element) {
    return findUiSchema(element)['ui:widget'];
  };

  var calculateColSpan = function calculateColSpan(element) {
    var type = findSchemaType(element);
    var field = findUiSchemaField(element);
    var widget = findUiSchemaWidget(element);
    var defaultColSpan = properties.length < 2 || // Single or no field in object.
    type === 'object' || type === 'array' || widget === 'textarea' ? 24 : 12;

    if (_.isObject(colSpan)) {
      return colSpan[widget] || colSpan[field] || colSpan[type] || defaultColSpan;
    }

    if (_.isNumber(colSpan)) {
      return colSpan;
    }

    return defaultColSpan;
  };

  return /*#__PURE__*/React.createElement("fieldset", {
    id: idSchema.$id
  }, /*#__PURE__*/React.createElement(Row, {
    gutter: rowGutter
  }, uiSchema['ui:title'] !== false && (uiSchema['ui:title'] || title) && /*#__PURE__*/React.createElement(Col, {
    className: labelColClassName,
    span: 24
  }, /*#__PURE__*/React.createElement(TitleField, {
    id: "".concat(idSchema.$id, "-title"),
    required: required,
    title: uiSchema['ui:title'] || title
  })), uiSchema['ui:description'] !== false && (uiSchema['ui:description'] || description) && /*#__PURE__*/React.createElement(Col, {
    span: 24,
    style: DESCRIPTION_COL_STYLE
  }, /*#__PURE__*/React.createElement(DescriptionField, {
    description: uiSchema['ui:description'] || description,
    id: "".concat(idSchema.$id, "-description")
  })), properties.filter(function (e) {
    return !e.hidden;
  }).map(function (element) {
    return /*#__PURE__*/React.createElement(Col, {
      key: element.name,
      span: calculateColSpan(element)
    }, element.content);
  })), canExpand(schema, uiSchema, formData) && /*#__PURE__*/React.createElement(Col, {
    span: 24
  }, /*#__PURE__*/React.createElement(Row, {
    gutter: rowGutter,
    justify: "end"
  }, /*#__PURE__*/React.createElement(Col, {
    flex: "192px"
  }, /*#__PURE__*/React.createElement(Button, {
    block: true,
    className: "object-property-expand",
    disabled: disabled || readonly,
    onClick: onAddClick(schema),
    type: "primary"
  }, /*#__PURE__*/React.createElement(PlusCircleOutlined, null), " Add Item")))));
};

export default withConfigConsumer({
  prefixCls: 'form'
})(ObjectFieldTemplate);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy90ZW1wbGF0ZXMvT2JqZWN0RmllbGRUZW1wbGF0ZS9pbmRleC5qcyJdLCJuYW1lcyI6WyJSZWFjdCIsImNsYXNzTmFtZXMiLCJfIiwidXRpbHMiLCJCdXR0b24iLCJDb2wiLCJSb3ciLCJ3aXRoQ29uZmlnQ29uc3VtZXIiLCJQbHVzQ2lyY2xlT3V0bGluZWQiLCJjYW5FeHBhbmQiLCJERVNDUklQVElPTl9DT0xfU1RZTEUiLCJwYWRkaW5nQm90dG9tIiwiT2JqZWN0RmllbGRUZW1wbGF0ZSIsIkRlc2NyaXB0aW9uRmllbGQiLCJUaXRsZUZpZWxkIiwiZGVzY3JpcHRpb24iLCJkaXNhYmxlZCIsImZvcm1Db250ZXh0IiwiZm9ybURhdGEiLCJpZFNjaGVtYSIsIm9uQWRkQ2xpY2siLCJwcmVmaXhDbHMiLCJwcm9wZXJ0aWVzIiwicmVhZG9ubHkiLCJyZXF1aXJlZCIsInNjaGVtYSIsInRpdGxlIiwidWlTY2hlbWEiLCJjb2xTcGFuIiwibGFiZWxBbGlnbiIsInJvd0d1dHRlciIsImxhYmVsQ2xzQmFzaWMiLCJsYWJlbENvbENsYXNzTmFtZSIsImZpbmRTY2hlbWEiLCJlbGVtZW50IiwiY29udGVudCIsInByb3BzIiwiZmluZFNjaGVtYVR5cGUiLCJ0eXBlIiwiZmluZFVpU2NoZW1hIiwiZmluZFVpU2NoZW1hRmllbGQiLCJmaW5kVWlTY2hlbWFXaWRnZXQiLCJjYWxjdWxhdGVDb2xTcGFuIiwiZmllbGQiLCJ3aWRnZXQiLCJkZWZhdWx0Q29sU3BhbiIsImxlbmd0aCIsImlzT2JqZWN0IiwiaXNOdW1iZXIiLCIkaWQiLCJmaWx0ZXIiLCJlIiwiaGlkZGVuIiwibWFwIiwibmFtZSJdLCJtYXBwaW5ncyI6IkFBQUEsT0FBT0EsS0FBUCxNQUFrQixPQUFsQjtBQUNBLE9BQU9DLFVBQVAsTUFBdUIsWUFBdkI7QUFDQSxPQUFPQyxDQUFQLE1BQWMsUUFBZDtBQUVBLFNBQVNDLEtBQVQsUUFBc0IsWUFBdEI7QUFDQSxPQUFPQyxNQUFQLE1B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c0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0IGZyb20gJ3JlYWN0JztcclxuaW1wb3J0IGNsYXNzTmFtZXMgZnJvbSAnY2xhc3NuYW1lcyc7XHJcbmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XHJcblxyXG5pbXBvcnQgeyB1dGlscyB9IGZyb20gJ0ByanNmL2NvcmUnO1xyXG5pbXBvcnQgQnV0dG9uIGZyb20gJ2FudGQvbGliL2J1dHRvbic7XHJcbmltcG9ydCBDb2wgZnJvbSAnYW50ZC9saWIvY29sJztcclxuaW1wb3J0IFJvdyBmcm9tICdhbnRkL2xpYi9yb3cnO1xyXG5pbXBvcnQgeyB3aXRoQ29uZmlnQ29uc3VtZXIgfSBmcm9tICdhbnRkL2xpYi9jb25maWctcHJvdmlkZXIvY29udGV4dCc7XHJcbmltcG9ydCBQbHVzQ2lyY2xlT3V0bGluZWQgZnJvbSAnQGFudC1kZXNpZ24vaWNvbnMvUGx1c0NpcmNsZU91dGxpbmVkJztcclxuXHJcbmNvbnN0IHsgY2FuRXhwYW5kIH0gPSB1dGlscztcclxuXHJcbmNvbnN0IERFU0NSSVBUSU9OX0NPTF9TVFlMRSA9IHtcclxuICBwYWRkaW5nQm90dG9tOiAnOHB4JyxcclxufTtcclxuXHJcbmNvbnN0IE9iamVjdEZpZWxkVGVtcGxhdGUgPSAoe1xyXG4gIERlc2NyaXB0aW9uRmllbGQsXHJcbiAgVGl0bGVGaWVsZCxcclxuICBkZXNjcmlwdGlvbixcclxuICBkaXNhYmxlZCxcclxuICBmb3JtQ29udGV4dCxcclxuICBmb3JtRGF0YSxcclxuICBpZFNjaGVtYSxcclxuICBvbkFkZENsaWNrLFxyXG4gIHByZWZpeENscyxcclxuICBwcm9wZXJ0aWVzLFxyXG4gIHJlYWRvbmx5LFxyXG4gIHJlcXVpcmVkLFxyXG4gIHNjaGVtYSxcclxuICB0aXRsZSxcclxuICB1aVNjaGVtYSxcclxufSkgPT4ge1xyXG4gIGNvbnN0IHsgY29sU3BhbiA9IDI0LCBsYWJlbEFsaWduID0gJ3JpZ2h0Jywgcm93R3V0dGVyID0gMjQgfSA9IGZvcm1Db250ZXh0O1xyXG5cclxuICBjb25zdCBsYWJlbENsc0Jhc2ljID0gYCR7cHJlZml4Q2xzfS1pdGVtLWxhYmVsYDtcclxuICBjb25zdCBsYWJlbENvbENsYXNzTmFtZSA9IGNsYXNzTmFtZXMoXHJcbiAgICBsYWJlbENsc0Jhc2ljLFxyXG4gICAgbGFiZWxBbGlnbiA9PT0gJ2xlZnQnICYmIGAke2xhYmVsQ2xzQmFzaWN9LWxlZnRgLFxyXG4gICAgLy8gbGFiZWxDb2wuY2xhc3NOYW1lLFxyXG4gICk7XHJcblxyXG4gIGNvbnN0IGZpbmRTY2hlbWEgPSAoZWxlbWVudCkgPT4gZWxlbWVudC5jb250ZW50LnByb3BzLnNjaGVtYTtcclxuXHJcbiAgY29uc3QgZmluZFNjaGVtYVR5cGUgPSAoZWxlbWVudCkgPT4gZmluZFNjaGVtYShlbGVtZW50KS50eXBlO1xyXG5cclxuICBjb25zdCBmaW5kVWlTY2hlbWEgPSAoZWxlbWVudCkgPT4gZWxlbWVudC5jb250ZW50LnByb3BzLnVpU2NoZW1hO1xyXG5cclxuICBjb25zdCBmaW5kVWlTY2hlbWFGaWVsZCA9IChlbGVtZW50KSA9PiBmaW5kVWlTY2hlbWEoZWxlbWVudClbJ3VpOmZpZWxkJ107XHJcblxyXG4gIGNvbnN0IGZpbmRVaVNjaGVtYVdpZGdldCA9IChlbGVtZW50KSA9PiBmaW5kVWlTY2hlbWEoZWxlbWVudClbJ3VpOndpZGdldCddO1xyXG5cclxuICBjb25zdCBjYWxjdWxhdGVDb2xTcGFuID0gKGVsZW1lbnQpID0+IHtcclxuICAgIGNvbnN0IHR5cGUgPSBmaW5kU2NoZW1hVHlwZShlbGVtZW50KTtcclxuICAgIGNvbnN0IGZpZWxkID0gZmluZFVpU2NoZW1hRmllbGQoZWxlbWVudCk7XHJcbiAgICBjb25zdCB3aWRnZXQgPSBmaW5kVWlTY2hlbWFXaWRnZXQoZWxlbWVudCk7XHJcblxyXG4gICAgY29uc3QgZGVmYXVsdENvbFNwYW4gPVxyXG4gICAgICBwcm9wZXJ0aWVzLmxlbmd0aCA8IDIgfHwgLy8gU2luZ2xlIG9yIG5vIGZpZWxkIGluIG9iamVjdC5cclxuICAgICAgdHlwZSA9PT0gJ29iamVjdCcgfHxcclxuICAgICAgdHlwZSA9PT0gJ2FycmF5JyB8fFxyXG4gICAgICB3aWRnZXQgPT09ICd0ZXh0YXJlYSdcclxuICAgICAgICA/IDI0XHJcbiAgICAgICAgOiAxMjtcclxuXHJcbiAgICBpZiAoXy5pc09iamVjdChjb2xTcGFuKSkge1xyXG4gICAgICByZXR1cm4gKFxyXG4gICAgICAgIGNvbFNwYW5bd2lkZ2V0XSB8fCBjb2xTcGFuW2ZpZWxkXSB8fCBjb2xTcGFuW3R5cGVdIHx8IGRlZmF1bHRDb2xTcGFuXHJcbiAgICAgICk7XHJcbiAgICB9XHJcbiAgICBpZiAoXy5pc051bWJlcihjb2xTcGFuKSkge1xyXG4gICAgICByZXR1cm4gY29sU3BhbjtcclxuICAgIH1cclxuICAgIHJldHVybiBkZWZhdWx0Q29sU3BhbjtcclxuICB9O1xyXG5cclxuICByZXR1cm4gKFxyXG4gICAgPGZpZWxkc2V0IGlkPXtpZFNjaGVtYS4kaWR9PlxyXG4gICAgICA8Um93IGd1dHRlcj17cm93R3V0dGVyfT5cclxuICAgICAgICB7dWlTY2hlbWFbJ3VpOnRpdGxlJ10gIT09IGZhbHNlICYmICh1aVNjaGVtYVsndWk6dGl0bGUnXSB8fCB0aXRsZSkgJiYgKFxyXG4gICAgICAgICAgPENvbCBjbGFzc05hbWU9e2xhYmVsQ29sQ2xhc3NOYW1lfSBzcGFuPXsyNH0+XHJcbiAgICAgICAgICAgIDxUaXRsZUZpZWxkXHJcbiAgICAgICAgICAgICAgaWQ9e2Ake2lkU2NoZW1hLiRpZH0tdGl0bGVgfVxyXG4gICAgICAgICAgICAgIHJlcXVpcmVkPXtyZXF1aXJlZH1cclxuICAgICAgICAgICAgICB0aXRsZT17dWlTY2hlbWFbJ3VpOnRpdGxlJ10gfHwgdGl0bGV9XHJcbiAgICAgICAgICAgIC8+XHJcbiAgICAgICAgICA8L0NvbD5cclxuICAgICAgICApfVxyXG4gICAgICAgIHt1aVNjaGVtYVsndWk6ZGVzY3JpcHRpb24nXSAhPT0gZmFsc2UgJiZcclxuICAgICAgICAgICh1aVNjaGVtYVsndWk6ZGVzY3JpcHRpb24nXSB8fCBkZXNjcmlwdGlvbikgJiYgKFxyXG4gICAgICAgICAgICA8Q29sIHNwYW49ezI0fSBzdHlsZT17REVTQ1JJUFRJT05fQ09MX1NUWUxFfT5cclxuICAgICAgICAgICAgICA8RGVzY3JpcHRpb25GaWVsZFxyXG4gICAgICAgICAgICAgICAgZGVzY3JpcHRpb249e3VpU2NoZW1hWyd1aTpkZXNjcmlwdGlvbiddIHx8IGRlc2NyaXB0aW9ufVxyXG4gICAgICAgICAgICAgICAgaWQ9e2Ake2lkU2NoZW1hLiRpZH0tZGVzY3JpcHRpb25gfVxyXG4gICAgICAgICAgICAgIC8+XHJcbiAgICAgICAgICAgIDwvQ29sPlxyXG4gICAgICAgICAgKX1cclxuICAgICAgICB7cHJvcGVydGllcy5maWx0ZXIoKGUpID0+ICFlLmhpZGRlbikubWFwKChlbGVtZW50KSA9PiAoXHJcbiAgICAgICAgICA8Q29sIGtleT17ZWxlbWVudC5uYW1lfSBzcGFuPXtjYWxjdWxhdGVDb2xTcGFuKGVsZW1lbnQpfT5cclxuICAgICAgICAgICAge2VsZW1lbnQuY29udGVudH1cclxuICAgICAgICAgIDwvQ29sPlxyXG4gICAgICAgICkpfVxyXG4gICAgICA8L1Jvdz5cclxuXHJcbiAgICAgIHtjYW5FeHBhbmQoc2NoZW1hLCB1aVNjaGVtYSwgZm9ybURhdGEpICYmIChcclxuICAgICAgICA8Q29sIHNwYW49ezI0fT5cclxuICAgICAgICAgIDxSb3cgZ3V0dGVyPXtyb3dHdXR0ZXJ9IGp1c3RpZnk9XCJlbmRcIj5cclxuICAgICAgICAgICAgPENvbCBmbGV4PVwiMTkycHhcIj5cclxuICAgICAgICAgICAgICA8QnV0dG9uXHJcbiAgICAgICAgICAgICAgICBibG9ja1xyXG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lPVwib2JqZWN0LXByb3BlcnR5LWV4cGFuZFwiXHJcbiAgICAgICAgICAgICAgICBkaXNhYmxlZD17ZGlzYWJsZWQgfHwgcmVhZG9ubHl9XHJcbiAgICAgICAgICAgICAgICBvbkNsaWNrPXtvbkFkZENsaWNrKHNjaGVtYSl9XHJcbiAgICAgICAgICAgICAgICB0eXBlPVwicHJpbWFyeVwiXHJcbiAgICAgICAgICAgICAgPlxyXG4gICAgICAgICAgICAgICAgPFBsdXNDaXJjbGVPdXRsaW5lZCAvPiBBZGQgSXRlbVxyXG4gICAgICAgICAgICAgIDwvQnV0dG9uPlxyXG4gICAgICAgICAgICA8L0NvbD5cclxuICAgICAgICAgIDwvUm93PlxyXG4gICAgICAgIDwvQ29sPlxyXG4gICAgICApfVxyXG4gICAgPC9maWVsZHNldD5cclxuICApO1xyXG59O1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgd2l0aENvbmZpZ0NvbnN1bWVyKHsgcHJlZml4Q2xzOiAnZm9ybScgfSkoT2JqZWN0RmllbGRUZW1wbGF0ZSk7XHJcbiJdfQ==